//
//  RYGPersonPackageViewController.m
//  shoumila
//
//  Created by 阴～ on 15/9/12.
//  Copyright (c) 2015年 如意谷. All rights reserved.
//

#import "RYGPersonPackageViewController.h"
#import "RYGAllListParam.h"
#import "RYGSubScribeParam.h"
#import "RYGHttpRequest.h"
#import "RYGPackageDetailModel.h"

@interface RYGPersonPackageViewController ()

@property (nonatomic,strong)    RYGPackageDetailModel* packageDetailModel;

@end

@implementation RYGPersonPackageViewController

-(void)viewWillAppear:(BOOL)animated
{
    [super viewWillAppear:animated];
    
    [self.tabBarController.tabBar setHidden:YES];
}

-(void)viewWillDisappear:(BOOL)animated
{
    [super viewWillDisappear:animated];
    
}

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    self.view.backgroundColor = ColorRankMyRankBackground;
    self.navigationItem.title = @"TA的私人套餐";
    
    [self loadNewData];
}

- (void)loadNewData {
    RYGAllListParam *listParam = [RYGAllListParam param];
    listParam.userid = _userid;
    [RYGHttpRequest postWithURL:Package_Detail params:listParam.keyValues success:^(id json) {
        
        NSMutableDictionary *dic = [json valueForKey:@"data"];
        _packageDetailModel = [RYGPackageDetailModel objectWithKeyValues:dic];
        
        if (dic) {
            [self createEmptyView];
        }
        else {
            self.navigationItem.title = [NSString stringWithFormat:@"%@的私人套餐",_packageDetailModel.service_term];
            [self createMainView];
        }
        
    } failure:^(NSError *error) {
        
    }];
}

- (void)createEmptyView{
    UIImageView* emptyImageView = [[UIImageView alloc]initWithFrame:CGRectMake(0, 148, 85, 58)];
    emptyImageView.centerX = SCREEN_WIDTH/2;
    emptyImageView.image = [UIImage imageNamed:@"user_personEmpty"];
    [self.view addSubview:emptyImageView];
    
    UILabel* emptyLabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 246, 200, 20)];
    emptyLabel.centerX = SCREEN_WIDTH/2;
    emptyLabel.text = @"TA没有开通私人套餐";
    emptyLabel.textAlignment = NSTextAlignmentCenter;
    emptyLabel.textColor = ColorSecondTitle;
    emptyLabel.font = [UIFont systemFontOfSize:14];
    [self.view addSubview:emptyLabel];
}

- (void)createMainView {
    UIView* whiteView = [[UIView alloc]initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, 310)];
    whiteView.backgroundColor = ColorRankBackground;
    [self.view addSubview:whiteView];
    
    UIView* lineView = [[UIView alloc]initWithFrame:CGRectMake(0, whiteView.height-0.5, SCREEN_WIDTH, 0.5)];
    lineView.backgroundColor = ColorLine;
    [whiteView addSubview:lineView];
    
    UILabel* bigNumLabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 46, 100, 50)];
    bigNumLabel.text = _packageDetailModel.target_win_rate;
    bigNumLabel.centerX = SCREEN_WIDTH/2;
    bigNumLabel.font = [UIFont systemFontOfSize:68];
    bigNumLabel.textColor = ColorRateTitle;
    [whiteView addSubview:bigNumLabel];
    
    UILabel* percentLabel = [[UILabel alloc]initWithFrame:CGRectMake(SCREEN_WIDTH/2+30, 80, 30, 22)];
    percentLabel.text = @"％";
    percentLabel.font = [UIFont systemFontOfSize:20];
    percentLabel.textColor = ColorRateTitle;
    [whiteView addSubview:percentLabel];
    
    UILabel* wantRateLabel = [[UILabel alloc]initWithFrame:CGRectMake(0, 105, 100, 20)];
    wantRateLabel.text = @"目标胜率";
    wantRateLabel.centerX = SCREEN_WIDTH/2;
    wantRateLabel.font = [UIFont systemFontOfSize:17];
    wantRateLabel.textColor = ColorWantRate;
    [whiteView addSubview:wantRateLabel];
    
    //限定场次
    UILabel* xdcc_label = [self createLabelFrame:CGRectMake(35, 155, 50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:12] withColor:ColorName withText:@"限定场次"];
    [whiteView addSubview:xdcc_label];
    UILabel* xdcc_num = [self createLabelFrame:CGRectMake(35, 175, 50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:15] withColor:ColorName withText:[NSString stringWithFormat:@"%@场",_packageDetailModel.matches]];
    [whiteView addSubview:xdcc_num];
    
    //需要净胜
    UILabel* xyjs_label = [self createLabelFrame:CGRectMake(35, 155, 50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:12] withColor:ColorName withText:@"需要净胜"];
    xyjs_label.centerX = SCREEN_WIDTH/2;
    [whiteView addSubview:xyjs_label];
    UILabel* xyjs_num = [self createLabelFrame:CGRectMake(35, 175, 50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:15] withColor:ColorName withText:[NSString stringWithFormat:@"%@场",_packageDetailModel.target_win]];
    xyjs_num.centerX = SCREEN_WIDTH/2;
    [whiteView addSubview:xyjs_num];
    
    //服务期限
    UILabel* fwqx_label = [self createLabelFrame:CGRectMake(SCREEN_WIDTH-85, 155, 50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:12] withColor:ColorName withText:@"服务期限"];
    [whiteView addSubview:fwqx_label];
    UILabel* fwqx_num = [self createLabelFrame:CGRectMake(SCREEN_WIDTH-85, 175, 50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:15] withColor:ColorName withText:[NSString stringWithFormat:@"%@天",_packageDetailModel.service_term]];
    [whiteView addSubview:fwqx_num];
    
    UIView* middlelineView = [[UIView alloc]initWithFrame:CGRectMake(58, 200, SCREEN_WIDTH-116, 1)];
    middlelineView.backgroundColor = ColorLine;
    [whiteView addSubview:middlelineView];
    
    UIView* circle_front_view = [[UIView alloc]initWithFrame:CGRectMake(35, 200, 10, 10)];
    circle_front_view.backgroundColor = ColorLine;
    circle_front_view.layer.cornerRadius = 5;
    circle_front_view.center = CGPointMake(58, 200);
    [whiteView addSubview:circle_front_view];
    
    UIView* circle_middle_view = [[UIView alloc]initWithFrame:CGRectMake(35, 200, 10, 10)];
    circle_middle_view.backgroundColor = ColorLine;
    circle_middle_view.layer.cornerRadius = 5;
    circle_middle_view.center = CGPointMake(SCREEN_WIDTH/2, 200);
    [whiteView addSubview:circle_middle_view];
    
    UIView* circle_back_view = [[UIView alloc]initWithFrame:CGRectMake(35, 200, 10, 10)];
    circle_back_view.backgroundColor = ColorLine;
    circle_back_view.layer.cornerRadius = 5;
    circle_back_view.center = CGPointMake(SCREEN_WIDTH-58, 200);
    [whiteView addSubview:circle_back_view];
    
    UIButton* subScribeButton = [UIButton buttonWithType:UIButtonTypeCustom];
    subScribeButton.frame = CGRectMake(0, 0, 160, 160);
    subScribeButton.center = CGPointMake(SCREEN_WIDTH/2, 310);
    subScribeButton.layer.cornerRadius = 80;
    [subScribeButton setTitle:[NSString stringWithFormat:@"订阅\n%@元",_packageDetailModel.fee] forState:UIControlStateNormal];
    [subScribeButton setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
    [subScribeButton setBackgroundColor:ColorRateTitle];
    [subScribeButton addTarget:self action:@selector(gotoSubScribe) forControlEvents:UIControlEventTouchUpInside];
    subScribeButton.titleLabel.font = [UIFont systemFontOfSize:24];
    subScribeButton.titleLabel.textAlignment = NSTextAlignmentCenter;
    subScribeButton.titleLabel.numberOfLines = 0;
    [self.view addSubview:subScribeButton];
    
    //tips
    UILabel* tipslabel = [self createLabelFrame:CGRectMake(25, 410, SCREEN_WIDTH-50, 20) withAlignment:NSTextAlignmentCenter withFont:[UIFont systemFontOfSize:13] withColor:ColorRankMedal withText:@"温馨提示：每周为7天，每月为30天"];
    [self.view addSubview:tipslabel];
}

-(UILabel*)createLabelFrame:(CGRect)frame withAlignment:(NSTextAlignment)alignment withFont:(UIFont*)font withColor:(UIColor*)color withText:(NSString*)text
{
    UILabel* label = [[UILabel alloc]initWithFrame:frame];
    label.textAlignment = alignment;
    label.font = font;
    label.numberOfLines = 0;
    label.textColor = color;
    label.text = text;
    return label;
}

- (void)gotoSubScribe {
    RYGSubScribeParam *subscribeParam = [RYGSubScribeParam param];
    subscribeParam.package_id = _packageDetailModel.id;
    subscribeParam.userid = _packageDetailModel.userid;
    [RYGHttpRequest postWithURL:User_UserMoney params:subscribeParam.keyValues success:^(id json) {
        
        if ([[json valueForKey:@"code"] intValue] == 0) {
            //订阅成功
            
        }
        
    } failure:^(NSError *error) {
        
    }];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}

@end
